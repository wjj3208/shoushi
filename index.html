<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å­™ä½³å†²è¥¿ç­ç‰™å°è®°</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #050505; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            touch-action: none; 
        }
        
        /* éšè—è§†é¢‘å…ƒç´ ï¼Œå¾®ä¿¡X5å†…æ ¸é€‚é… */
        #input_video { 
            position: absolute; 
            top: -9999px; 
            left: -9999px; 
            width: 1px; height: 1px; opacity: 0;
        }

        /* ---------------- ç›¸å†Œç”»å»Šæ ·å¼ ---------------- */
        #gallery-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%; /* æ‰‹æœºå±å¹•å æ¯” */
            max-width: 500px;
            aspect-ratio: 3/4; /* ç«–å±ç…§ç‰‡æ¯”ä¾‹ */
            z-index: 2; /* åœ¨ç²’å­ä¹‹ä¸Š */
            pointer-events: none; /* è®©é¼ æ ‡äº‹ä»¶ç©¿é€ï¼Œä¸å½±å“æ—‹è½¬ç²’å­ */
            perspective: 1000px;
        }

        #photo-card {
            width: 100%;
            height: 100%;
            background-color: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            overflow: hidden;
            position: relative;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.27), opacity 0.3s;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #photo-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* ç…§ç‰‡åˆ‡æ¢åŠ¨ç”»ç±» */
        .swipe-left { transform: translate(-50%, -50%) translateX(-100px) rotate(-15deg) !important; opacity: 0 !important; }
        .swipe-right { transform: translate(-50%, -50%) translateX(100px) rotate(15deg) !important; opacity: 0 !important; }

        /* ä¸Šä¼ æŒ‰é’® */
        #upload-btn-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 20;
        }
        #file-input { display: none; }
        .icon-btn {
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.3);
            color: #fff;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            backdrop-filter: blur(5px);
            cursor: pointer;
        }

        /* ---------------- UI é¢æ¿ ---------------- */
        #ui-container {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            background: rgba(20, 20, 20, 0.9);
            backdrop-filter: blur(15px);
            padding: 15px 15px 30px 15px;
            border-radius: 20px 20px 0 0;
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            color: #fff;
            z-index: 10;
            box-sizing: border-box;
        }
        
        #shape-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* ä¸€è¡Œ4ä¸ª */
            gap: 6px;
            margin-top: 10px;
        }

        .shape-btn {
            padding: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: #ccc;
            border-radius: 8px;
            font-size: 12px;
            text-align: center;
        }
        .shape-btn.active { background: #00d2ff; color: #000; font-weight: bold; }
        .shape-btn.special { border-color: #00ff00; color: #88ff88; } /* åœ£è¯æ ‘æŒ‰é’®ç‰¹æ•ˆ */

        /* çŠ¶æ€æ  */
        #status-bar {
            position: absolute;
            top: 20px; left: 20px;
            display: flex; flex-direction: column; gap: 5px;
            z-index: 5; pointer-events: none;
        }
        .status-tag {
            background: rgba(0,0,0,0.6);
            color: #00d2ff;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            backdrop-filter: blur(4px);
            width: fit-content;
        }

        /* é¢„è§ˆçª—å£ */
        #webcam-preview {
            position: absolute;
            top: 80px; left: 20px;
            width: 100px; height: 75px;
            background: #000;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            transform: scaleX(-1);
            z-index: 5;
            display: none;
            opacity: 0.7;
        }

        /* å¯åŠ¨é®ç½© */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92); z-index: 999;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: white; text-align: center;
        }
        #start-btn {
            padding: 15px 40px;
            background: linear-gradient(45deg, #00d2ff, #007aff);
            color: #fff; border: none; border-radius: 50px;
            font-size: 18px; font-weight: bold;
            margin-top: 20px; cursor: pointer;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>

    <!-- å¯åŠ¨é¡µ -->
    <div id="start-overlay">
        <h2>ğŸ‘‹ å­™ä½³å†²è¥¿ç­ç‰™å°è®°</h2>
        <p style="font-size:14px; color:#aaa; line-height:1.6;">
            å·¦å³æŒ¥æ‰‹ï¼šåˆ‡æ¢ç…§ç‰‡<br>
            å¼ åˆæ‰‹æŒï¼šæ§åˆ¶ç²’å­ç¼©æ”¾<br>
            ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä¸Šä¼ ä½ è‡ªå·±çš„ç…§ç‰‡
        </p>
        <button id="start-btn">å¼€å¯æ‘„åƒå¤´ä½“éªŒ</button>
    </div>

    <!-- ä¸Šä¼ æŒ‰é’® -->
    <div id="upload-btn-container">
        <label for="file-input" class="icon-btn">ğŸ“ ä¸Šä¼ ç…§ç‰‡</label>
        <input type="file" id="file-input" multiple accept="image/*">
    </div>

    <!-- çŠ¶æ€æ˜¾ç¤º -->
    <div id="status-bar">
        <div class="status-tag" id="status-text">ç­‰å¾…å¯åŠ¨...</div>
        <div class="status-tag" id="gesture-hint" style="color:#ffcc00; display:none;">æ£€æµ‹åˆ°æŒ¥æ‰‹!</div>
    </div>

    <!-- ç›¸å†Œç”»å»Š -->
    <div id="gallery-container">
        <div id="photo-card">
            <!-- é»˜è®¤å›¾ç‰‡: ä½¿ç”¨ Unsplash å»ºç­‘ç±»å›¾ç‰‡ä½œä¸ºå ä½ -->
            <img id="photo-img" src="https://images.unsplash.com/photo-1583422409516-2895a77efded?w=500&q=80" alt="Gallery Photo">
        </div>
    </div>

    <video id="input_video" playsinline webkit-playsinline x5-video-player-type="h5-page" x5-playsinline="true" muted autoplay></video>
    <canvas id="webcam-preview"></canvas>

    <div id="ui-container">
        <div style="font-size:12px; color:#888; margin-bottom:5px;">ç²’å­æ¨¡å‹åˆ‡æ¢</div>
        <div id="shape-buttons">
            <div class="shape-btn special" data-shape="tree">ğŸ„åœ£è¯æ ‘</div>
            <div class="shape-btn active" data-shape="heart">çˆ±å¿ƒ</div>
            <div class="shape-btn" data-shape="saturn">åœŸæ˜Ÿ</div>
            <div class="shape-btn" data-shape="firework">çƒŸèŠ±</div>
            <div class="shape-btn" data-shape="flower">èŠ±æœµ</div>
            <div class="shape-btn" data-shape="buddha">ä½›åƒ</div>
            <div class="shape-btn" data-shape="sphere">çƒä½“</div>
            <div class="shape-btn" data-shape="helix">åŒèºæ—‹</div>
        </div>
        <div style="margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
            <label style="font-size:12px; color:#888;">ç²’å­é¢œè‰²</label>
            <input type="color" id="color-picker" value="#00d2ff" style="width:50px; height:25px; border:none;">
        </div>
    </div>

<script>
    // ================= é…ç½®å‚æ•° =================
    const PARTICLE_COUNT = 10000; // ç²’å­æ•°é‡
    const PARTICLE_SIZE = 0.15;
    const SWIPE_THRESHOLD = 0.15; // æŒ¥æ‰‹åˆ¤å®šé˜ˆå€¼ (0-1ä¹‹é—´ï¼Œè¶Šå¤§è¶Šéš¾è§¦å‘)
    
    // ================= å…¨å±€å˜é‡ =================
    let scene, camera, renderer, particles, material;
    let basePositions = new Float32Array(PARTICLE_COUNT * 3);
    let handScaleFactor = 1.0;
    let targetHandScale = 1.0;
    let currentShape = 'heart';

    // ç›¸å†Œæ•°æ®
    let photos = [
        "https://images.unsplash.com/photo-1583422409516-2895a77efded?w=600&q=80", // å·´å¡ç½—é‚£1
        "https://images.unsplash.com/photo-1523531294919-4bcd7c65e216?w=600&q=80", // å·´å¡ç½—é‚£2
        "https://images.unsplash.com/photo-1511527661048-7fe73d85e9a4?w=600&q=80", // å»ºç­‘3
        "https://images.unsplash.com/photo-1544985651-76495f32cb74?w=600&q=80"  // å»ºç­‘4
    ];
    let currentPhotoIndex = 0;

    // æ‰‹åŠ¿è¯†åˆ«å˜é‡
    let lastWristX = null;
    let swipeCooldown = 0;

    // DOM å…ƒç´ 
    const statusEl = document.getElementById('status-text');
    const gestureHintEl = document.getElementById('gesture-hint');
    const photoImg = document.getElementById('photo-img');
    const photoCard = document.getElementById('photo-card');
    const videoElement = document.getElementById('input_video');
    const previewCanvas = document.getElementById('webcam-preview');
    const previewCtx = previewCanvas.getContext('2d');

    // ================= ç…§ç‰‡ä¸Šä¼ é€»è¾‘ =================
    document.getElementById('file-input').addEventListener('change', function(e) {
        if (this.files && this.files.length > 0) {
            // æ¸…ç©ºæ—§ç…§ç‰‡æˆ–è¿½åŠ  (è¿™é‡Œé€‰æ‹©è¿½åŠ )
            // photos = []; 
            
            Array.from(this.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photos.unshift(e.target.result); // æ·»åŠ åˆ°å¼€å¤´
                    updatePhoto(0); // ç«‹å³æ˜¾ç¤ºä¸Šä¼ çš„ç¬¬ä¸€å¼ 
                };
                reader.readAsDataURL(file);
            });
            alert(`å·²æ·»åŠ  ${this.files.length} å¼ ç…§ç‰‡åˆ°ç›¸å†Œ`);
        }
    });

    function updatePhoto(index) {
        if (photos.length === 0) return;
        if (index < 0) index = photos.length - 1;
        if (index >= photos.length) index = 0;
        
        currentPhotoIndex = index;
        
        // ç®€å•çš„æ·¡å…¥æ·¡å‡ºæ•ˆæœ
        photoCard.style.opacity = 0;
        setTimeout(() => {
            photoImg.src = photos[currentPhotoIndex];
            photoCard.style.opacity = 1;
        }, 200);
    }

    function triggerSwipe(direction) {
        if (photos.length <= 1) return;
        
        // åŠ¨ç”»
        const animationClass = direction === 'next' ? 'swipe-left' : 'swipe-right';
        photoCard.classList.add(animationClass);
        
        // æ˜¾ç¤ºæç¤º
        gestureHintEl.innerText = direction === 'next' ? "â‡¦ ä¸‹ä¸€å¼ " : "ä¸Šä¸€å¼  â‡¨";
        gestureHintEl.style.display = 'block';
        setTimeout(() => gestureHintEl.style.display = 'none', 1000);

        setTimeout(() => {
            if (direction === 'next') {
                updatePhoto(currentPhotoIndex + 1);
            } else {
                updatePhoto(currentPhotoIndex - 1);
            }
            photoCard.classList.remove(animationClass);
        }, 300);
    }

    // ================= Three.js ç²’å­ç³»ç»Ÿ =================
    function initThree() {
        scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.02);

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 25;

        renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.insertBefore(renderer.domElement, document.body.firstChild);

        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(PARTICLE_COUNT * 3);
        
        for(let i=0; i<PARTICLE_COUNT*3; i++) positions[i] = (Math.random()-0.5)*50;
        
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

        material = new THREE.PointsMaterial({
            color: new THREE.Color(0x00d2ff),
            size: PARTICLE_SIZE,
            transparent: true,
            opacity: 0.8,
            blending: THREE.AdditiveBlending
        });

        particles = new THREE.Points(geometry, material);
        scene.add(particles);

        generateShape('tree'); // é»˜è®¤åœ£è¯æ ‘
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    }

    // ================= ç²’å­å½¢çŠ¶ç®—æ³• (å«åœ£è¯æ ‘) =================
    function getPoint(type, i) {
        let x=0, y=0, z=0;
        const u = Math.random();
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos(2 * Math.random() - 1);

        switch(type) {
            case 'tree': // ğŸ„ åœ£è¯æ ‘
                {
                    // æ ‘å¹²é«˜åº¦ 20, yèŒƒå›´ -10 åˆ° 10
                    const h = 25;
                    // yåˆ†å¸ƒåå‘ä¸‹éƒ¨
                    const y_norm = Math.pow(Math.random(), 0.8); // 0-1
                    y = y_norm * h - 12; 
                    
                    // åŠå¾„éšé«˜åº¦å‡å° (åœ†é”¥)
                    const maxR = 9 * (1 - y_norm);
                    const r = maxR * Math.sqrt(Math.random());
                    
                    // èºæ—‹ä¸Šå‡ç»“æ„
                    const spiral = y * 2.0; 
                    x = r * Math.cos(theta + spiral);
                    z = r * Math.sin(theta + spiral);

                    // å¢åŠ ä¸€ç‚¹éšæœºè£…é¥°ç‚¹åœ¨å¤–å›´
                    if(Math.random() > 0.95) {
                        x *= 1.1; z *= 1.1;
                    }
                }
                break;

            case 'heart':
                x = 16 * Math.pow(Math.sin(theta), 3);
                y = 13 * Math.cos(theta) - 5 * Math.cos(2*theta) - 2 * Math.cos(3*theta) - Math.cos(4*theta);
                z = (Math.random()-0.5) * 5;
                { const s = 0.5; x*=s; y*=s; z*=s; y+=2; }
                break;
                
            case 'saturn':
                 if(Math.random()>0.3) {
                    const r = 6 * Math.cbrt(Math.random());
                    x=r*Math.sin(phi)*Math.cos(theta); y=r*Math.sin(phi)*Math.sin(theta); z=r*Math.cos(phi);
                } else {
                    const r=Math.sqrt(Math.random()*(196-64)+64);
                    x=r*Math.cos(theta); z=r*Math.sin(theta); y=(Math.random()-0.5)*0.5;
                    const t=0.4;
                    const yt=y*Math.cos(t)-z*Math.sin(t);
                    const zt=y*Math.sin(t)+z*Math.cos(t);
                    y=yt; z=zt;
                }
                break;
                
            case 'firework':
                { const r=15*Math.cbrt(Math.random()); x=r*Math.sin(phi)*Math.cos(theta); y=r*Math.sin(phi)*Math.sin(theta); z=r*Math.cos(phi); }
                break;
                
            case 'flower':
                { const k=3; const r=10*Math.cos(k*theta)+5; const rv=r*Math.random(); x=rv*Math.cos(theta); y=rv*Math.sin(theta); z=(Math.random()-0.5)*4+Math.cos(theta*k)*2; }
                break;
                
            case 'sphere':
                { const r=10*Math.cbrt(Math.random()); x=r*Math.sin(phi)*Math.cos(theta); y=r*Math.sin(phi)*Math.sin(theta); z=r*Math.cos(phi); }
                break;

            case 'helix':
                { 
                    const t = (i / PARTICLE_COUNT) * 10 * Math.PI;
                    x = 6 * Math.cos(t);
                    z = 6 * Math.sin(t);
                    y = (i / PARTICLE_COUNT) * 20 - 10;
                    // åŒèºæ—‹
                    if (i % 2 === 0) { x = -x; z = -z; }
                }
                break;
            
            case 'buddha':
                {
                     const d = Math.random();
                     if(d<0.2){ const r=2.5*Math.cbrt(Math.random()); x=r*Math.sin(phi)*Math.cos(theta); y=r*Math.sin(phi)*Math.sin(theta)+6; z=r*Math.cos(phi); }
                     else if(d<0.6){ const r=4.5*Math.cbrt(Math.random()); x=r*Math.sin(phi)*Math.cos(theta); y=r*Math.sin(phi)*Math.sin(theta)*1.2; z=r*Math.cos(phi)*0.8; }
                     else { const r=6*Math.sqrt(Math.random()); x=r*Math.cos(theta); z=r*Math.sin(theta)*0.8; y=(Math.random()-1)*2-3; }
                }
                break;
        }
        return {x,y,z};
    }

    function generateShape(shape) {
        currentShape = shape;
        for(let i=0; i<PARTICLE_COUNT; i++) {
            const p = getPoint(shape, i);
            basePositions[i*3] = p.x;
            basePositions[i*3+1] = p.y;
            basePositions[i*3+2] = p.z;
        }
        // å¦‚æœæ˜¯æ ‘ï¼Œé¢œè‰²æ”¹ç»¿è‰²ï¼›å…¶ä»–æ¢å¤ç”¨æˆ·è‰²
        if(shape === 'tree') {
            material.color.setHex(0x22ff55);
        } else {
            material.color.set(document.getElementById('color-picker').value);
        }
    }

    // ================= æ‰‹åŠ¿ä¸é€»è¾‘ =================
    function onResults(results) {
        previewCtx.clearRect(0,0,160,120);
        previewCtx.drawImage(results.image, 0, 0, 160, 120);
        
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            const landmarks = results.multiHandLandmarks[0];
            const wrist = landmarks[0]; // æ‰‹è…•åæ ‡

            statusEl.innerText = "å·²æ•è·æ‰‹åŠ¿";
            statusEl.style.color = "#00ff00";

            // 1. è®¡ç®—æŒ¥æ‰‹ (Swipe)
            // landmarks[0].x æ˜¯å½’ä¸€åŒ–çš„æ°´å¹³åæ ‡ (0-1)
            // æ³¨æ„ï¼šå‰ç½®æ‘„åƒå¤´é€šå¸¸æ˜¯é•œåƒçš„ã€‚
            // åŠ¨ä½œï¼šæ‰‹ä»ç”»é¢å·¦è¾¹ç§»åˆ°å³è¾¹ => x å¢åŠ  => è¿™æ˜¯ç”¨æˆ·çš„â€œå³æ‰‹å‘å³æŒ¥â€
            
            if (swipeCooldown > 0) {
                swipeCooldown--;
            } else {
                if (lastWristX !== null) {
                    const diff = wrist.x - lastWristX;
                    
                    // åˆ¤å®šé˜ˆå€¼
                    if (diff > SWIPE_THRESHOLD) {
                        // å¿«é€Ÿå‘å³ (User swipes Right)
                        triggerSwipe('prev');
                        swipeCooldown = 30; // å†·å´å¸§æ•°
                    } else if (diff < -SWIPE_THRESHOLD) {
                        // å¿«é€Ÿå‘å·¦ (User swipes Left)
                        triggerSwipe('next');
                        swipeCooldown = 30;
                    }
                }
            }
            lastWristX = wrist.x;

            // 2. è®¡ç®—ç¼©æ”¾ (Pinch)
            const p1 = landmarks[4]; // æ‹‡æŒ‡
            const p2 = landmarks[8]; // é£ŸæŒ‡
            const dist = Math.sqrt(Math.pow(p1.x-p2.x, 2) + Math.pow(p1.y-p2.y, 2));
            
            // å½’ä¸€åŒ–ç¼©æ”¾
            let ratio = (dist - 0.05) / 0.2; 
            if(ratio < 0) ratio = 0; if(ratio > 1) ratio = 1;
            targetHandScale = 0.5 + ratio * 2.0;

        } else {
            statusEl.innerText = "è¯·å°†æ‰‹æ”¾å…¥é•œå¤´";
            statusEl.style.color = "#00d2ff";
            targetHandScale = 1.0;
            lastWristX = null;
        }
    }

    // ================= å¯åŠ¨é€»è¾‘ =================
    document.getElementById('start-btn').addEventListener('click', () => {
        if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
            alert("âš ï¸ å¿…é¡»ä½¿ç”¨ HTTPS åè®®ï¼Œå¦åˆ™æ‘„åƒå¤´æ— æ³•å¯åŠ¨ã€‚");
            return;
        }

        document.getElementById('start-overlay').style.display = 'none';
        document.getElementById('webcam-preview').style.display = 'block';

        initThree();
        animate();

        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 0,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });
        hands.onResults(onResults);

        const cameraUtils = new Camera(videoElement, {
            onFrame: async () => {
                if(videoElement.videoWidth) await hands.send({image: videoElement});
            },
            width: 320, height: 240, facingMode: 'user'
        });

        cameraUtils.start();
    });

    function animate() {
        requestAnimationFrame(animate);
        
        // å¹³æ»‘ç¼©æ”¾
        handScaleFactor += (targetHandScale - handScaleFactor) * 0.1;

        if (particles) {
            particles.rotation.y += 0.003; // è‡ªè½¬
            
            const pos = particles.geometry.attributes.position.array;
            for(let i=0; i<PARTICLE_COUNT; i++) {
                const i3 = i*3;
                // åº”ç”¨æ‰‹åŠ¿ç¼©æ”¾
                const tx = basePositions[i3] * handScaleFactor;
                const ty = basePositions[i3+1] * handScaleFactor;
                const tz = basePositions[i3+2] * handScaleFactor;

                // ç§»åŠ¨æ’å€¼
                pos[i3] += (tx - pos[i3]) * 0.1;
                pos[i3+1] += (ty - pos[i3+1]) * 0.1;
                pos[i3+2] += (tz - pos[i3+2]) * 0.1;
            }
            particles.geometry.attributes.position.needsUpdate = true;
            renderer.render(scene, camera);
        }
    }

    // äº¤äº’äº‹ä»¶
    document.getElementById('shape-buttons').addEventListener('click', (e) => {
        if(e.target.classList.contains('shape-btn')) {
            document.querySelectorAll('.shape-btn').forEach(b=>b.classList.remove('active'));
            e.target.classList.add('active');
            generateShape(e.target.dataset.shape);
        }
    });
    document.getElementById('color-picker').addEventListener('input', (e) => {
        material.color.set(e.target.value);
    });

</script>
</body>
</html>